#+TITLE: 将博客从heroku迁移到github
#+DATE: 2021-07-11T16:29:26+08:00
#+TAGS[]: emacs org hugo
#+KEYWORDS[]:
#+CATEGORIES[]:  emacs org
#+lastmod: [2021-07-11 16:37]

* 前言

  虽然我的博客很久都没有更新过了，以前写博客的过程是相当艰辛，历经了很多次迁移。最近在思考一个问题，为什么我现在连博客也不写了？

  趁这个周末，我将原来布署在 =heroku= 上的博客迁移到了 =github= （虽然我曾经也使用过github），也将博客转换从 =hexo= 迁移到了  =hugo=。

* 迁移过程

  我以前也记录了怎么从 =hexo= 迁移到 =hugo= 的文章，需要转换的可以看一下。以前我使用 =ox-hugo= 来转换到hugo支持的markdown，现在我决定不再使用 =ox-hugo= 了，我决定直接使用 =org-mode= 来写博客。


** 初始化博客

   安装hugo直接参考官方文档。这里先初始化

   #+begin_src sh
     hugo new site /path/to/site
   #+end_src

** 配置主题

   这里我使用 =submodule= 的方式引入了 =even= 主题，为了保证兼容性，我从[[https://github.com/olOwOlo/hugo-theme-even][官方]]仓库 =fork= 了一份出来，防止以后升级不兼容，然后使用 =submodule= 引入：

   #+begin_src sh
     git submodule add https://github.com/chenzaichun/hugo-theme-even.git themes/even
   #+end_src

** 配置

   拷贝  =themes/even/exampleSite/config.toml= 到site根目录下，然后按照要求修改配置。


** 配置github actions自动发布

   这里使用了[[https://github.com/peaceiris/actions-hugo][peaceiris/actions-hugo]] 来自动发布，我修改了一下， 使用了 =master= 分支来发布， =.github/workflows/gh-pages.yml= 配置如下：

   #+begin_src yaml
     name: github pages
     
     on:
       push:
         branches:
           - master  # Set a branch to deploy
       pull_request:
     
     jobs:
       deploy:
         runs-on: ubuntu-20.04
         steps:
           - uses: actions/checkout@v2
             with:
               submodules: true  # Fetch Hugo themes (true OR recursive)
               fetch-depth: 0    # Fetch all history for .GitInfo and .Lastmod
     
           - name: Setup Hugo
             uses: peaceiris/actions-hugo@v2
             with:
               hugo-version: '0.85.0'
               extended: true
     
           - name: Build
             run: hugo --minify
     
           - name: Deploy
             uses: peaceiris/actions-gh-pages@v3
             if: github.ref == 'refs/heads/master'
             with:
               github_token: ${{ secrets.GITHUB_TOKEN }}
               publish_dir: ./public
   #+end_src

** comment

   这里采用了[[https://github.com/gitalk/gitalk][gitalk]]来作为comment， =even= 只需要简单的配置好对应的repo, client id, client sec就可以直接使用了
* 迁移完成

  每次push代码后会自动发布
